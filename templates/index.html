<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Local PDF RAG</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: 24px auto; }
    .box { border: 1px solid #ddd; padding: 12px; margin-bottom: 12px; border-radius: 6px; }
    .small { font-size: 0.9rem; color: #555; }
    .snippet { background:#fafafa; padding:8px; border-radius:4px; margin-bottom:6px; }
  </style>
</head>
<body>
  <h2>Local PDF RAG</h2>

  <!-- Upload -->
  <div class="box">
    <h4>Upload PDF (auto-index)</h4>
    <form action="/" method="post" enctype="multipart/form-data">
      <input type="file" name="pdf" accept="application/pdf" required>
      <button type="submit">Upload & Index</button>
    </form>
    <p class="small">Uploaded PDFs: {{ uploaded_files|length }} â€” {{ uploaded_files }}</p>
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul>
          {% for m in messages %}<li>{{ m }}</li>{% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
  </div>

  <!-- Question -->
  <div class="box">
    <h4>Ask a question (RAG)</h4>
    <form action="/" method="post">
      <input type="text" name="question" placeholder="Type your question" style="width:70%" required>
      <button type="submit">Ask</button>
    </form>
  </div>

  <!-- Answer -->
  {% if answer %}
    <div class="box">
      <h4>Answer</h4>
      <div>{{ answer }}</div>
    </div>
  {% endif %}

  <!-- Retrieved context -->
  {% if retrieved %}
    <div class="box">
      <h4>Top retrieved snippets</h4>
      {% for r in retrieved %}
        <div class="snippet">
          <div class="small"><strong>Source:</strong> {{ r.source }} &nbsp; <strong>id:</strong> {{ r.id }} &nbsp; <strong>dist:</strong> {{ '%.4f'|format(r.distance) }}</div>
          <div>{{ r.chunk[:500] }}{% if r.chunk|length > 500 %}...{% endif %}</div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
</body>
</html>
